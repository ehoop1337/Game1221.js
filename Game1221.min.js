/**
* Game1221.js
* The game resembles "2048", the differences are: the dropout of cells 1 or 2,
* you can also combine horizontally, vertically and at the corners of the selected goal
* @author Ruslan Sayfutdinov   https://github.com/ehoop1337/Game1221.js
* @param1 {string} selector    To which DOM element are we creating an instance of the class
*/
"use strict";class Game1221{constructor(e){this.countField=16,this.collumnAndRow=4,this.fieldSize=70,this.fieldBorderWidth=1,this.countCreateObjects=10,this.fieldEmptyColor="#eee",this.fieldColorText="#000",this.fieldHoverColor="#e4e4e4",this.fieldActiveColor="orange",this.fieldActiveColorText="#fff",this.fieldBorderColor="#fff",this.fields=[],this.game=document.querySelector(e),this.initStyleBody(),this.initStylesForGameField(),this.createFieldsAndInitStyles(),this.createButton(),this.createObjects(),this.createScore(),this.render()}createScore(){let e=document.createElement("section"),t=document.createElement("span");t.id="score",e.innerHTML="Score: ",t.innerHTML="0",e.appendChild(t),e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.fontSize="18px",e.style.bottom="calc(100% + 10px)",this.game.appendChild(e)}createButton(){let e=document.createElement("button");e.innerHTML="Restart",e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top="calc(100% + 10px)",e.style.margin="0 auto",e.style.padding="7px 20px 8px 20px",this.game.appendChild(e),e.addEventListener("click",()=>{this.restart()})}restart(){window.location.reload()}initStyleBody(){document.body.style.boxSizing="border-box",document.body.style.margin="0",document.body.style.padding="0",document.body.style.width="100vw",document.body.style.height="100vh",document.body.style.display="flex",document.body.style.justifyContent="center",document.body.style.alignItems="center"}initStylesForGameField(){this.game.style.display="flex",this.game.style.flexWrap="wrap",this.game.style.position="relative",this.game.style.width=this.fieldSize*this.collumnAndRow+"px"}createFieldsAndInitStyles(){for(let e=0;e<this.countField;e++){let t=document.createElement("div");t.id="field-"+(e+1),t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.fontSize="20px",t.style.fontWeight="700",t.style.background=this.fieldEmptyColor,t.style.width=this.fieldSize-2*this.fieldBorderWidth+"px",t.style.height=this.fieldSize-2*this.fieldBorderWidth+"px",t.style.border="solid "+this.fieldBorderWidth+"px "+this.fieldBorderColor,this.game.appendChild(t),this.fields.push({element:t,object:0,active:!1}),t.addEventListener("click",()=>{if(t.innerHTML.length>0){if("active"!=t.classList)t.classList.add("active"),this.logicGame(t),this.checkDual(t);else{t.classList.remove("active");for(let e=0;e<this.fields.length;e++)this.fields[e].active=!1}this.render()}})}}logicGame(e){let t=parseInt(e.id.replace(/[^\d\+]/g,""))-1;this.fields[t].active=!0}createObjects(e=0){let t=0,i=[];for(let e=0;e<this.fields.length;e++)0==this.fields[e].object&&(t+=1,i.push(e));let s=this.countCreateObjects;if(e>0&&(s=t>this.countField/this.collumnAndRow?this.getRandom(2,5):t>this.collumnAndRow?this.getRandom(1,4):t>1?this.getRandom(0,2):1==t?1:0),t<s&&0!=t)for(let e=0;e<i.length;e++){let t=this.createGameObject(i[e]);this.fields[i[e]].object=t.object}else if(0==t)this.sendNotice("There are no empty cells!");else for(let e=0;e<s;e++){let e=this.createGameObject();this.fields[e.field].object=e.object}}sendNotice(e){alert(e)}createGameObject(e=null){if(null==e){let e=this.getRandom(0,this.countField);return 0==this.fields[e].object?{field:e,object:this.getRandom(1,3)}:this.createGameObject()}return{field:e,object:this.getRandom(1,3)}}getRandom(e,t){return parseInt(Math.random()*(t-e)+e)}newPick(e=0){this.createObjects(e),this.render()}checkDual(e){let t=parseInt(e.id.replace(/[^\d\+]/g,""))-1;for(let e=0;e<this.fields.length;e++)if(t!=e&&this.fields[t].active==this.fields[e].active&&0!=this.fields[t].active&&0!=this.fields[e].active)if(this.fields[t].object==this.fields[e].object){let i=!1,s=!1,l=!1,o=!1,d=!1,n=!1,c=!1,h=!1;e-this.collumnAndRow>=0&&e-this.collumnAndRow==t&&(i=!0),e-this.collumnAndRow>=0&&(e+1)%this.collumnAndRow!=0&&e-(this.collumnAndRow-1)==t&&(s=!0),e-this.collumnAndRow>=0&&e%this.collumnAndRow!=0&&e-(this.collumnAndRow+1)==t&&(h=!0),e+this.collumnAndRow<this.countField&&e+this.collumnAndRow==t&&(d=!0),e<this.countField-this.collumnAndRow&&(e+1)%this.collumnAndRow!=0&&e+(this.collumnAndRow+1)==t&&(o=!0),e<this.countField-this.collumnAndRow&&e%this.collumnAndRow!=0&&e+(this.collumnAndRow-1)==t&&(n=!0),(e+1)%this.collumnAndRow!=0&&e+1==t&&(l=!0),e%this.collumnAndRow!=0&&e-1==t&&(c=!0),i||s||l||o||d||n||c||h?(1==this.fields[t].object?this.fields[t].object=2:this.fields[t].object=this.fields[t].object+this.fields[t].object,this.fields[t].element.classList.remove("active"),this.fields[t].active=!1,this.fields[e].object="",this.fields[e].element.classList.remove("active"),this.fields[e].active=!1,this.newPick(2)):(alert("error"),this.fields[t].element.classList.remove("active"),this.fields[t].active=!1,this.fields[e].element.classList.remove("active"),this.fields[e].active=!1)}else this.fields[t].element.classList.remove("active"),this.fields[t].active=!1,this.fields[e].element.classList.remove("active"),this.fields[e].active=!1}render(){let e=0;for(let t=0;t<this.fields.length;t++)0==this.fields[t].object?this.fields[t].element.innerHTML="":(this.fields[t].element.innerHTML=this.fields[t].object,e+=this.fields[t].object);document.querySelector("#score").innerHTML=e}}